{% extends "_sm_base.html" %}
{% load static %}
<!-- Extra CSS -->
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/sm_home.css' %}" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/htmx.js"></script>
{% endblock extra_css %}
{% block title %}
    Swap Manager - Home
{% endblock title %}
{% block content %}
    <div class="top-title">
        <h1>Swap Manager Home</h1>
    </div>
    <div class="curve-container">
        <div id="spot-rates-container">
            <form id="spot-rates-form">
                {% csrf_token %}
                {% for tenor in tenors.keys %}
                    <label for="{{ tenor }}">{{ tenor }}</label>
                    <input type="number"
                           step="0.01"
                           name="{{ tenor }}"
                           id="{{ tenor }}"
                           hx-post="{% url 'generate_chart' %}"
                           hx-trigger="change"
                           hx-target="#chart-container">
                    <br>
                {% endfor %}
            </form>
        </div>
    </div>
    <div>
        <div id="chart-container"></div>
    </div>
    <div>
        <form id="trigger-form">
            {% csrf_token %}
            <input type="number"
                   name="discount-trigger"
                   id="discount-trigger"
                   hx-post="{% url "discount_chart" %}"
                   hx-trigger="change"
                   hx-target="#discount-container">
        </form>
        <div id="discount-container"></div>
    </div>
    <div>
        <form action="{% url "download_discount" %}" method="post">
            {% csrf_token %}
            <button type="submit">Download Excel</button>
        </form>
    </div>
    <div>
        <form id="swap-inputs-form">
            {% csrf_token %}
            <label for="notional">Notional</label>
            <input type="number" name="notional" id="notional">
            <br>
            <label for="fix-rate">Fix rate</label>
            <input type="number" name="fix-rate" id="fix-rate">
            <br>
            <label for="flow-years">Years</label>
            <input type="number" name="flow-years" id="flow-years">
            <br>
            <button type="submit"
                    hx-post="{% url "generate_swap" %}"
                    hx-trigger="click"
                    hx-target="#fix-leg-container">Generate Swap</button>
        </form>
    </div>
    <div>
        <div id="fix-leg-container"></div>
    </div>
    <!-- Asigno tenors_json a una variable JavaScript -->
    <script>const tenorsJson = {{ tenors_json|safe }};</script>
    <!-- JavaScript for initial rates -->
    <script src="{% static "js/initialRates.js" %}"></script>
    <!-- JavaScript to trigger the discount chart-->
    <script src="{% static "js/triggerDiscount.js" %}"></script>
{% endblock content %}
